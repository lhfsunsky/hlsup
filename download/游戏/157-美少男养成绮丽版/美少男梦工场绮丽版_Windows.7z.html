<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="UTF-8" /><title>恢复 157-美少男养成绮丽版\美少男梦工场绮丽版_Windows.7z</title><meta name="referrer" content="no-referrer"></head>
<body>
<h1>下载并恢复文件：157-美少男养成绮丽版\美少男梦工场绮丽版_Windows.7z</h1>
<button id="startBtn">开始下载合并</button>
<progress id="progress" max="100" value="0" style="width: 100%;"></progress>
<p id="status"></p>

<script>
const urls = ['https://i0.hdslb.com/bfs/openplatform/12fbc9608926f5bd1ef366210bdbf7776efdd743.bin', 'https://i0.hdslb.com/bfs/openplatform/8a66b87d28fb35a2bd1674e2f2b872aa4868fc32.bin', 'https://i0.hdslb.com/bfs/openplatform/e9188cccd5ca3d21d50e9c86f1ee9077aaa7a9cb.bin', 'https://i0.hdslb.com/bfs/openplatform/49323643d8957ffa206577151f445157304cdb58.bin', 'https://i0.hdslb.com/bfs/openplatform/af031f9115aed951a8817ca0bd4c3e09887f73bf.bin', 'https://i0.hdslb.com/bfs/openplatform/68d9017439f6089371286a934fb5475c1de1c19b.bin', 'https://i0.hdslb.com/bfs/openplatform/802a7b6c1d86b898d796416bbfbcc51e4112a937.bin', 'https://i0.hdslb.com/bfs/openplatform/2f126430f6c0ee3567eead543a53126445ffd120.bin', 'https://i0.hdslb.com/bfs/openplatform/d846702078b8ce4e4acfe909d23a23a989adf920.bin', 'https://i0.hdslb.com/bfs/openplatform/418576e882ae892689a81a1f2393674c8df23df3.bin', 'https://i0.hdslb.com/bfs/openplatform/c8b0329184847edae33c5f35fcde9b711509d087.bin', 'https://i0.hdslb.com/bfs/openplatform/bf754c04b37ab8a18c9714483ea34c8c412021f4.bin', 'https://i0.hdslb.com/bfs/openplatform/d04e80c3885a13912b35c77c3e9a0c59a0e9ff48.bin', 'https://i0.hdslb.com/bfs/openplatform/eaa41488843484f614e5051bba2589b2231f3e73.bin', 'https://i0.hdslb.com/bfs/openplatform/0f53478eaa75f96f009eccdf527d2da717f81a6f.bin', 'https://i0.hdslb.com/bfs/openplatform/b2f8009f0f44e802f82de13eb452dd89b1361971.bin', 'https://i0.hdslb.com/bfs/openplatform/01c38b0319b04e0a39349634ccf53020dd34fdd5.bin', 'https://i0.hdslb.com/bfs/openplatform/b40d35bed701182615306697098692b9c90ddf99.bin', 'https://i0.hdslb.com/bfs/openplatform/a7cbf948ec88fb9d33c665c7294110abccb0eb87.bin', 'https://i0.hdslb.com/bfs/openplatform/eedc8177fbf8763e13babc43aec4c12c1c63411a.bin', 'https://i0.hdslb.com/bfs/openplatform/f1b6c467d048a4f60664b798e27e389e906f077f.bin', 'https://i0.hdslb.com/bfs/openplatform/7f9941f9958c46e29e858b24091c5494781b3c59.bin', 'https://i0.hdslb.com/bfs/openplatform/78b646a708c2f5269e95d8b1ecc47856d063de28.bin', 'https://i0.hdslb.com/bfs/openplatform/3a3cccfd44357168e4f8338be5af512f135b3a12.bin', 'https://i0.hdslb.com/bfs/openplatform/56793f07d769825f92c571bc513fcfb7ba07feae.bin', 'https://i0.hdslb.com/bfs/openplatform/beabd7f0992b6aa3b3cabb34070f1d77139f5a0e.bin'];
const maskKey = 0xAA;

async function downloadAndMerge() {
  if (!window.showSaveFilePicker) {
    alert("当前浏览器不支持 File System Access API，请使用 Chrome 或 Edge 的最新版本。");
    return;
  }

  const fileHandle = await window.showSaveFilePicker({
    suggestedName: '157-美少男养成绮丽版\美少男梦工场绮丽版_Windows.7z',
    types: [{
      description: '157-美少男养成绮丽版\美少男梦工场绮丽版_Windows.7z 文件',
      accept: {'*/*': ['.7z']}
    }]
  });
  const writable = await fileHandle.createWritable();

  const progressElem = document.getElementById('progress');
  const statusElem = document.getElementById('status');

  let totalBytes = 0;
  let downloadedBytes = 0;

  for (const url of urls) {
    const headResp = await fetch(url, { method: 'HEAD' });
    if (!headResp.ok) {
      statusElem.textContent = `无法获取分片大小: ${url}`;
      return;
    }
    totalBytes += parseInt(headResp.headers.get('Content-Length') || '0');
  }
  progressElem.max = totalBytes;

  try {
    for (let i = 0; i < urls.length; i++) {
      const url = urls[i];
      const resp = await fetch(url);
      if (!resp.ok) throw new Error(`下载失败: ${url}`);

      const reader = resp.body.getReader();
      let done = false;

      while (!done) {
        const {value, done: doneReading} = await reader.read();
        if (value) {
          let chunk = value;
          if (i === 0) {
            chunk = new Uint8Array(chunk);
            for (let j = 0; j < chunk.length; j++) {
              chunk[j] ^= maskKey;
            }
          }
          await writable.write(chunk);
          downloadedBytes += chunk.length;
          progressElem.value = downloadedBytes;
          statusElem.textContent = `已下载 ${downloadedBytes} / ${totalBytes} 字节 (${((downloadedBytes/totalBytes)*100).toFixed(2)}%)`;
        }
        done = doneReading;
      }
    }
    await writable.close();
    statusElem.textContent = "下载并合并完成！文件已保存。";
  } catch (e) {
    statusElem.textContent = "错误：" + e.message;
    await writable.close();
  }
}

document.getElementById('startBtn').addEventListener('click', downloadAndMerge);
</script>
</body>
</html>
